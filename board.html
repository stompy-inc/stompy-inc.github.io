<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>board (image & video)</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        /* ç”»åƒãƒ»å‹•ç”»å…±é€šã®ãƒ‰ãƒ©ãƒƒã‚°å¯¾è±¡ */
        .draggable {
            position: absolute;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }
        /* é¸æŠä¸­ */
        .selected {
            border: 2px solid blue;
        }
        /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®åŠé€æ˜ã‚³ãƒ”ãƒ¼ */
        .clone {
            opacity: 0.5;
            pointer-events: none;
        }

        textarea {
            position: absolute;
            top: 40px;
            background: none;
            border: none;
            color: deeppink;
            font-weight: bold;
            width: 27px;
            height: 300px;
            font-size: 25px;
            font-family: sans-serif;
            overflow: hidden;
            writing-mode: vertical-rl;
            text-orientation: upright;
            line-height: 90%;
        }
    </style>
</head>
<body style="overflow:hidden;background:#4c4a48;">

    <div style="padding:5px">
        <button id="fullscreenBtn">ğŸ’»</button>
        <script>
            // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒœã‚¿ãƒ³ã®å‡¦ç†
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            fullscreenBtn.addEventListener('click', function () {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen?.() ||
                        document.documentElement.webkitRequestFullscreen?.() ||
                        document.documentElement.mozRequestFullScreen?.() ||
                        document.documentElement.msRequestFullscreen?.();
                } else {
                    document.exitFullscreen?.() ||
                        document.webkitExitFullscreen?.() ||
                        document.mozCancelFullScreen?.() ||
                        document.msExitFullscreen?.();
                }
            });
        </script>
        <!-- éš ã—ã¦ãŠã input[type=file] -->
        <input type="file" id="fileInput" style="display:none;" multiple>
        <button id="customUploadBtn">ğŸ¨</button>
        <script>
            const customUploadBtn = document.getElementById('customUploadBtn');
            customUploadBtn.addEventListener('click', () => fileInput.click());
        </script>
    </div>

    <script>
        let selectedElem = null;   // é¸æŠä¸­è¦ç´ (img / video)
        let clone = null;          // ãƒ‰ãƒ©ãƒƒã‚°ç”¨ã‚¯ãƒ­ãƒ¼ãƒ³

        let id_count = 0;          // è¦ç´ idç”¨ã‚«ã‚¦ãƒ³ã‚¿
        let z_index_count = 0;     // é‡ãªã‚Šé †

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        document.getElementById('fileInput').addEventListener('change', function (e) {
            const files = e.target.files;

            for (let file of files) {
                // ç”»åƒ
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const img = new Image();
                        img.src = event.target.result;
                        prepareElement(img);
                    }
                    reader.readAsDataURL(file);
                }
                // å‹•ç”» (mp4 / ãã®ä»– video/*)
                else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.controls = true;
                    video.loop = true
                    video.width = 320; // åˆæœŸå¹…
                    prepareElement(video);
                }
            }
            // input ã‚’ãƒªã‚»ãƒƒãƒˆ
            e.target.value = '';
        });

        /* ç”»åƒãƒ»å‹•ç”»å…±é€šã®åˆæœŸåŒ–å‡¦ç† */
        function prepareElement(elem) {
            id_count++;
            elem.id = `elem_${id_count}`;
            elem.classList.add('draggable');
            elem.style.left = '0px';
            elem.style.top = '0px';
            document.body.appendChild(elem);
            addControlButtons(elem);
        }

        let offsetX, offsetY; // ãƒã‚¦ã‚¹ã¨ã‚¯ãƒ­ãƒ¼ãƒ³å·¦ä¸Šã¨ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ

        // è¦ç´ é¸æŠ & ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
        document.body.addEventListener('click', function (e) {
            // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº† (ã‚¯ãƒªãƒƒã‚¯ã§ç¢ºå®š)
            if (selectedElem && clone) {
                z_index_count++;
                selectedElem.style.left = clone.style.left;
                selectedElem.style.top = clone.style.top;
                selectedElem.style.zIndex = String(z_index_count);

                const btnGroup = document.getElementById('btn_' + selectedElem.id);
                if (btnGroup) {
                    btnGroup.style.left = clone.style.left;
                    btnGroup.style.top = clone.style.top;
                    btnGroup.style.zIndex = String(z_index_count);
                }

                // é¸æŠè§£é™¤
                selectedElem.classList.remove('selected');
                clone.remove();
                clone = null;
                selectedElem = null;
            }
            // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
            else if (e.target.classList.contains('draggable')) {
                if (selectedElem) {
                    selectedElem.classList.remove('selected');
                    clone?.remove();
                    clone = null;
                }
                selectedElem = e.target;
                selectedElem.classList.add('selected');

                if (!clone) {
                    clone = selectedElem.cloneNode(true);
                    clone.classList.add('clone');
                    clone.style.left = selectedElem.style.left;
                    clone.style.top = selectedElem.style.top;
                    document.body.appendChild(clone);

                    // ã‚¯ãƒ­ãƒ¼ãƒ³ã¨ãƒã‚¦ã‚¹ãƒã‚¤ãƒ³ã‚¿ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’ä¿å­˜
                    const rect = clone.getBoundingClientRect();
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                }
            }
        });

        // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ (ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’è¿½å¾“)
        document.body.addEventListener('mousemove', function (e) {
            if (clone) {
                clone.style.left = (e.clientX - offsetX) + 'px';
                clone.style.top = (e.clientY - offsetY) + 'px';
            }
        });
    </script>

    <script>
        // ç”»åƒãƒ»å‹•ç”»ç”¨ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³
        function addControlButtons(elem) {
            const enlargeBtn = createButton('+');
            const reduceBtn = createButton('-');
            const hideBtn = createButton('x');

            enlargeBtn.addEventListener('click', () => elem.width *= 1.1);
            reduceBtn.addEventListener('click', () => elem.width *= 0.9);
            hideBtn.addEventListener('click', () => {
                elem.style.display = 'none';
                document.getElementById('btn_' + elem.id).style.display = 'none';
            });

            const btnGroup = document.createElement('div');
            btnGroup.id = 'btn_' + elem.id;
            btnGroup.style.position = 'absolute';
            btnGroup.style.left = elem.style.left;
            btnGroup.style.top = elem.style.top;

            btnGroup.appendChild(enlargeBtn);
            btnGroup.appendChild(reduceBtn);
            btnGroup.appendChild(hideBtn);

            // ç¸¦æ›¸ããƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ 2ã¤ (å…ƒã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾)
            const txtArea1 = document.createElement('textarea');
            txtArea1.style.left = '10px';
            btnGroup.appendChild(txtArea1);

            const txtArea2 = document.createElement('textarea');
            txtArea2.style.left = '42px';
            btnGroup.appendChild(txtArea2);

            document.body.appendChild(btnGroup);
        }

        function createButton(text) {
            const btn = document.createElement('button');
            btn.innerText = text;
            btn.style.marginRight = '2px';
            return btn;
        }
    </script>
</body>
</html>
